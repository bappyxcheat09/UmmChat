<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
<title>Mini Chat Login</title>
<style>
  * {
    box-sizing: border-box;
  }
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: #121212;
    color: #eee;
    margin: 0; padding: 0;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
  }
  #login, #chat {
    background: #1f1f1f;
    width: 90vw;
    max-width: 400px;
    border-radius: 12px;
    padding: 20px;
  }
  #chat {
    display: none;
    flex-direction: column;
    height: 90vh;
  }
  h2 {
    margin-top: 0;
    text-align: center;
    font-weight: 600;
    color: #25d366;
  }
  input {
    width: 100%;
    padding: 12px 10px;
    margin: 10px 0;
    background: #222;
    border: none;
    border-radius: 8px;
    color: #eee;
    font-size: 16px;
  }
  button {
    width: 100%;
    background: #25d366;
    border: none;
    padding: 14px;
    border-radius: 8px;
    font-weight: bold;
    color: #121212;
    font-size: 16px;
    cursor: pointer;
    margin-top: 10px;
  }
  #loginError {
    color: #ff5252;
    text-align: center;
    margin-top: 5px;
    font-size: 14px;
  }
  #messages {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    background: #222;
    border-radius: 8px;
    margin-bottom: 10px;
  }
  .msg {
    margin-bottom: 8px;
    padding: 8px 12px;
    border-radius: 12px;
    max-width: 75%;
    word-wrap: break-word;
  }
  .me {
    background: #25d366;
    color: #121212;
    margin-left: auto;
  }
  .other {
    background: #333;
  }
  #inputArea {
    display: flex;
    gap: 8px;
  }
  #msgInput {
    flex: 1;
    padding: 10px;
    border-radius: 8px;
    border: none;
    font-size: 16px;
    background: #222;
    color: #eee;
  }
</style>
</head>
<body>

<!-- Login Section -->
<div id="login">
  <h2>Login to Chat</h2>
  <input type="text" id="username" placeholder="Username" autocomplete="off" />
  <input type="password" id="password" placeholder="Password" autocomplete="off" />
  <button id="loginBtn">Login</button>
  <div id="loginError"></div>
</div>

<!-- Chat Section -->
<div id="chat" style="display: flex; flex-direction: column;">
  <h2>Global Chat</h2>
  <div id="messages"></div>
  <div id="inputArea">
    <input id="msgInput" type="text" placeholder="Type a message..." autocomplete="off" />
    <button id="sendBtn">Send</button>
  </div>
</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
  import { getDatabase, ref, push, onValue, set } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

  // ফিক্সড ইউজারনেম ও পাসওয়ার্ড
  const validUsers = {
    "bappy": "1234",
    "user1": "abcd"
  };

  const firebaseConfig = {
    apiKey: "AIzaSyAxb8vACQClmiEsB886aaHFMAitu0wEVQo",
    authDomain: "ummchat009.firebaseapp.com",
    databaseURL: "https://ummchat009-default-rtdb.firebaseio.com/",
    projectId: "ummchat009",
    storageBucket: "ummchat009.appspot.com",
    messagingSenderId: "880860486384",
    appId: "1:880860486384:web:85ce4f7ccb70eb1c5f8035"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const chatRoom = "global_chat";

  // এলিমেন্টস
  const loginDiv = document.getElementById('login');
  const chatDiv = document.getElementById('chat');
  const loginBtn = document.getElementById('loginBtn');
  const loginError = document.getElementById('loginError');
  const usernameInput = document.getElementById('username');
  const passwordInput = document.getElementById('password');
  const messagesDiv = document.getElementById('messages');
  const msgInput = document.getElementById('msgInput');
  const sendBtn = document.getElementById('sendBtn');

  let currentUser = null;

  loginBtn.onclick = () => {
    const username = usernameInput.value.trim();
    const password = passwordInput.value.trim();

    if (validUsers[username] && validUsers[username] === password) {
      currentUser = username;
      loginDiv.style.display = 'none';
      chatDiv.style.display = 'flex';
      loginError.textContent = '';
      startChat();
    } else {
      loginError.textContent = 'Invalid username or password!';
    }
  };

  function startChat() {
    // Show existing messages and listen for new ones
    const chatRef = ref(db, "chats/" + chatRoom);

    onValue(chatRef, (snapshot) => {
      messagesDiv.innerHTML = '';
      snapshot.forEach(child => {
        const msg = child.val();
        const div = document.createElement('div');
        div.classList.add('msg');
        div.classList.add(msg.user === currentUser ? 'me' : 'other');
        div.textContent = `${msg.user}: ${msg.text}`;
        messagesDiv.appendChild(div);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    sendBtn.onclick = () => {
      const text = msgInput.value.trim();
      if (!text) return;
      const chatRefPush = ref(db, "chats/" + chatRoom);
      push(chatRefPush, {
        user: currentUser,
        text: text,
        timestamp: Date.now()
      });
      msgInput.value = '';
    };
  }
</script>

</body>
</html>
