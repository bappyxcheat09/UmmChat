<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>UmmChat WhatsApp Style</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
  <style>
    :root {
      --primary-bg: #111;
      --header-bg: #202c33;
      --my-msg-bg: #056162;
      --friend-msg-bg: #2a3942;
      --text-color: #e0e0e0;
      --accent-color: #25D366;
    }

    body {
      font-family: 'Roboto', sans-serif;
      background: var(--primary-bg);
      color: var(--text-color);
      margin: 0;
      display: flex;
      justify-content: center;
      height: 100vh;
    }

    #chatContainer {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 500px;
      height: 100%;
      background: var(--primary-bg);
      border-left: 1px solid #333;
      border-right: 1px solid #333;
    }

    header {
      display: flex;
      align-items: center;
      background: var(--header-bg);
      padding: 10px;
      gap: 10px;
    }

    #statusDot {
      width: 10px;
      height: 10px;
      background: gray;
      border-radius: 50%;
    }

    #statusText {
      font-size: 14px;
    }

    #messages {
      flex: 1;
      padding: 10px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 5px;
    }

    .msg {
      max-width: 80%;
      padding: 8px 12px;
      border-radius: 10px;
      position: relative;
      word-wrap: break-word;
    }

    .me {
      align-self: flex-end;
      background: var(--my-msg-bg);
    }

    .friend {
      align-self: flex-start;
      background: var(--friend-msg-bg);
    }

    .seen {
      font-size: 10px;
      position: absolute;
      bottom: 2px;
      right: 4px;
    }

    #inputArea {
      display: flex;
      padding: 8px;
      background: var(--header-bg);
      align-items: center;
      gap: 5px;
    }

    #msgInput {
      flex: 1;
      padding: 8px;
      border: none;
      border-radius: 20px;
      background: #2a3942;
      color: var(--text-color);
      font-size: 14px;
    }

    button {
      background: var(--accent-color);
      border: none;
      border-radius: 50%;
      width: 36px;
      height: 36px;
      color: #fff;
      font-size: 16px;
    }

    #emojiPanel {
      display: none;
      position: absolute;
      bottom: 60px;
      left: 10px;
      right: 10px;
      background: #2a3942;
      max-height: 200px;
      overflow-y: auto;
      border-radius: 10px;
      padding: 5px;
    }

    #emojiPanel span {
      font-size: 22px;
      padding: 4px;
      cursor: pointer;
    }

    #emojiBtn {
      font-size: 18px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div id="chatContainer">
    <header>
      <div id="statusDot"></div>
      <div id="statusText">Connecting...</div>
    </header>

    <div id="messages"></div>

    <div id="emojiPanel"></div>

    <div id="inputArea">
      <div id="emojiBtn">😊</div>
      <input type="text" id="msgInput" placeholder="Type a message" />
      <button id="sendBtn"><i class="fas fa-paper-plane"></i></button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getDatabase, ref, onValue, push, set, onDisconnect, update } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyBdYjBNFt1RzRZ70-28Mj9njeHsKf7sEMo",
      authDomain: "sample-firebase-ai-app-31682.firebaseapp.com",
      projectId: "sample-firebase-ai-app-31682",
      storageBucket: "sample-firebase-ai-app-31682.appspot.com",
      messagingSenderId: "531579886451",
      appId: "1:531579886451:web:c1bb2dec5c53255f240306"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const statusDot = document.getElementById('statusDot');
    const statusText = document.getElementById('statusText');
    const messagesDiv = document.getElementById('messages');
    const msgInput = document.getElementById('msgInput');
    const sendBtn = document.getElementById('sendBtn');
    const emojiPanel = document.getElementById('emojiPanel');
    const emojiBtn = document.getElementById('emojiBtn');

    let userId = localStorage.getItem('user_id') || 'user_' + Math.random().toString(36).substr(2,8);
    localStorage.setItem('user_id', userId);
    let chatId = prompt("Enter friend's ID or group ID:");
    if (!chatId) chatId = 'default_chat';

    const statusRef = ref(db, 'status/' + userId);
    const chatRef = ref(db, 'chats/' + chatId);

    set(statusRef, { state: 'online', lastSeen: Date.now() });
    onDisconnect(statusRef).set({ state: 'offline', lastSeen: Date.now() });

    onValue(ref(db, '.info/connected'), (snap) => {
      if (snap.val()) {
        statusDot.style.background = 'limegreen';
        statusText.textContent = 'Online';
      } else {
        statusDot.style.background = 'gray';
        statusText.textContent = 'Offline';
      }
    });

    sendBtn.onclick = () => {
      const text = msgInput.value.trim();
      if (!text) return;
      const msgRef = push(chatRef);
      set(msgRef, {
        userId,
        data: text,
        timestamp: Date.now(),
        seenBy: { [userId]: Date.now() }
      });
      msgInput.value = '';
    };

    onValue(chatRef, snap => {
      messagesDiv.innerHTML = '';
      snap.forEach(child => {
        const msg = child.val();
        const div = document.createElement('div');
        div.className = 'msg ' + (msg.userId === userId ? 'me' : 'friend');
        div.innerHTML = `${msg.data} <span class="seen">✔✔</span>`;
        if (msg.userId !== userId) {
          set(ref(db, `chats/${chatId}/${child.key}/seenBy/${userId}`), Date.now());
        }
        messagesDiv.appendChild(div);
      });
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    });

    const emojiList = ["😀","😁","😂","🤣","😃","😄","😅","😆","😉","😊","😋","😎","😍","😘","🥰","😗","😙","😚","🙂","🤗","🤩","🤔","🤨","😐","😑","😶","🙄","😏","😣","😥","😮","🤐","😯","😪","😫","😴","😌","😛","😜","😝","🤤","😒","😓","😔","😕","🙃","🤑","😲","☹️","🙁","😖","😞","😟","😤","😢","😭","😦","😧","😨","😩","🤯","😬","😰","😱","🥵","🥶","😳","🤪","😵","😡","😠","🤬","😷","🤒","🤕","🤢","🤮","🤧","😇","🥳","🥴","🥺","🤠","🤡","🤥","🤫","🤭","🧐"];

    emojiBtn.onclick = () => {
      if (emojiPanel.style.display === 'none' || emojiPanel.style.display === '') {
        emojiPanel.innerHTML = '';
        emojiList.forEach(e => {
          const span = document.createElement('span');
          span.textContent = e;
          span.onclick = () => {
            msgInput.value += e;
            msgInput.focus();
          };
          emojiPanel.appendChild(span);
        });
        emojiPanel.style.display = 'block';
      } else {
        emojiPanel.style.display = 'none';
      }
    };

    document.addEventListener('click', (e) => {
      if (!emojiPanel.contains(e.target) && e.target !== emojiBtn) {
        emojiPanel.style.display = 'none';
      }
    });
  </script>
</body>
</html>
